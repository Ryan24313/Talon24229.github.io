<html lang="en">

<head>
    <style>
        body {
            margin: 0;
            background-repeat: no-repeat;
            overflow: hidden;
            background-size: 100vw;
            background-color: rgb(0, 0, 0);
            font-family: "Comic Sans MS";
            text-align: center;
        }

        p {
            margin: 0;
        }

        #cabinet {
            position: absolute;
            height: 140%;
            z-index: 6;
            top: -25%;
            pointer-events: none;
        }

        #lemonadeClown {
            position: absolute;
            display: block;
            top: 20%;
            width: 20%;
            z-index: 1;
        }

        #background {
            position: absolute;
            top: 18%;
            height: 60%;
            width: 50%;
            z-index: 0;
        }

        #kid {
            position: absolute;
            top: 32%;
            left: 50%;
            width: 5%;
            z-index: 2;
        }

        #scareRange {
            background-color: rgba(199, 199, 199, 0.238);
            border-radius: 50%;
            position: absolute;
            z-index: 3;
        }

        #title {
            position: absolute;
            top: 24%;
            z-index: 5;
            color: rgb(255, 255, 255);
            text-shadow: 2px 0 rgb(0, 0, 0), -2px 0 rgb(0, 0, 0), 0 2px rgb(0, 0, 0), 0 -2px rgb(0, 0, 0),
                1px 1px rgb(0, 0, 0), -1px -1px rgb(0, 0, 0), 1px -1px rgb(0, 0, 0), -1px 1px rgb(0, 0, 0);
            font-size: 80px;
        }

        #directions {
            position: absolute;
            top: 35.5%;
            z-index: 5;
            color: rgb(255, 255, 255);
            text-shadow: 2px 0 rgb(0, 0, 0), -2px 0 rgb(0, 0, 0), 0 2px rgb(0, 0, 0), 0 -2px rgb(0, 0, 0),
                1px 1px rgb(0, 0, 0), -1px -1px rgb(0, 0, 0), 1px -1px rgb(0, 0, 0), -1px 1px rgb(0, 0, 0);
            font-size: 30px;
        }

        #controls {
            position: absolute;
            top: 69%;
            z-index: 5;
            color: rgb(255, 255, 255);
            text-shadow: 2px 0 rgb(0, 0, 0), -2px 0 rgb(0, 0, 0), 0 2px rgb(0, 0, 0), 0 -2px rgb(0, 0, 0),
                1px 1px rgb(0, 0, 0), -1px -1px rgb(0, 0, 0), 1px -1px rgb(0, 0, 0), -1px 1px rgb(0, 0, 0);
            font-size: 30px;
        }

        #modes {
            position: absolute;
            top: 53%;
            z-index: 5;
            color: rgb(255, 255, 255);
            text-shadow: 2px 0 rgb(0, 0, 0), -2px 0 rgb(0, 0, 0), 0 2px rgb(0, 0, 0), 0 -2px rgb(0, 0, 0),
                1px 1px rgb(0, 0, 0), -1px -1px rgb(0, 0, 0), 1px -1px rgb(0, 0, 0), -1px 1px rgb(0, 0, 0);
            font-size: 40px;
        }

        #modes>* {
            cursor: pointer;
            margin-bottom: 5%;
        }


        #score {
            z-index: 5;
            color: white;
            top: 67.7%;
            right: 6%;
            font-size: 50px;
            position: absolute;
            text-align: right;
            text-shadow: 2px 0 rgb(0, 0, 0), -2px 0 rgb(0, 0, 0), 0 2px rgb(0, 0, 0), 0 -2px rgb(0, 0, 0),
                1px 1px rgb(0, 0, 0), -1px -1px rgb(0, 0, 0), 1px -1px rgb(0, 0, 0), -1px 1px rgb(0, 0, 0);
        }

        .debugLines {
            position: absolute;
            width: 5px;
            height: 100%;
            z-index: 4;
        }

        .walls {
            background-color: green;
        }

        .scareEdges {
            background-color: red;
        }

        .center {
            left: 50%;
            transform: translateX(-50%);
        }
    </style>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Give kids Lemonade!</title>
</head>

<body>

    <div id="scareRange" class='center'></div>
    <p id="title" class='center'>Lemonada Clown</p>
    <p id='directions' class='center'>Surprise as many kids as you can!</p>
    <p id='controls' class='center'>Press Space</p>
    <div id="modes" class='center'>
        <p onclick="changeMode('normal')">Normal</p>
        <p onclick="changeMode('endless')">Endless</p>
        <p onclick="changeMode('timed')">Timed</p>
    </div>
    <p id="score" class='center'>0</p>
    <img id='cabinet' class='center' src=" ../cabinet.png">
    <img id='background' class='center' src="../miniGameBKG.png">
    <img id='lemonadeClown' class='center' src="idle.png">
    <div id='leftWall' class='walls debugLines'></div>
    <div id='rightWall' class='walls debugLines'></div>
    <div id='leftScare' class='scareEdges debugLines'></div>
    <div id='rightScare' class='scareEdges debugLines'></div>
    <script>
        const DEBUG = false
        const CHAIN_DISTANCE = 20
        const SCARE_DISTANCE = 150
        const WALL_DISTANCE = 400
        const LEMONADE_CLOWN = { element: document.getElementById('lemonadeClown'), position: document.getElementById('lemonadeClown').getBoundingClientRect().left }
        const LEFT_WALL = LEMONADE_CLOWN.position - WALL_DISTANCE + LEMONADE_CLOWN.element.clientWidth / 2
        const RIGHT_WAll = LEMONADE_CLOWN.position + WALL_DISTANCE + LEMONADE_CLOWN.element.clientWidth / 2
        var scareRange = document.getElementById("scareRange")
        var scareDiameter = SCARE_DISTANCE * 2 * 1.4
        scareRange.style.height = scareDiameter
        scareRange.style.width = scareDiameter
        scareRange.style.top = LEMONADE_CLOWN.element.getBoundingClientRect().top + scareRange.clientHeight / 5 + "px"
        var title = document.getElementById('title')
        var modesElement = document.getElementById('modes')
        var scoreElement = document.getElementById("score")
        var directions = document.getElementById('directions')
        var controls = document.getElementById('controls')

        //debug
        if (DEBUG) {
            document.getElementById('leftWall').style.visibility = ''
            document.getElementById('rightWall').style.visibility = ''
            document.getElementById('leftScare').style.visibility = ''
            document.getElementById('rightScare').style.visibility = ''
        } else {
            document.getElementById('leftWall').style.visibility = 'hidden'
            document.getElementById('rightWall').style.visibility = 'hidden'
            document.getElementById('leftScare').style.visibility = 'hidden'
            document.getElementById('rightScare').style.visibility = 'hidden'
        }

        document.getElementById('leftWall').style.left = LEFT_WALL
        document.getElementById('rightWall').style.left = RIGHT_WAll
        document.getElementById('leftScare').style.left = LEMONADE_CLOWN.position - SCARE_DISTANCE + LEMONADE_CLOWN.element.clientWidth / 2
        document.getElementById('rightScare').style.left = LEMONADE_CLOWN.position + SCARE_DISTANCE + LEMONADE_CLOWN.element.clientWidth / 2
        var mode = "menu"
        var scaring = false
        var scaredKids = 0
        var score = 0
        var gameStarted = false
        var canScare = false
        var didScare = false
        var slowTitleFlash
        var fastTitleFlash
        var kids = []

        //9 kids made, 100 points each, unless all are hit, then its 5,000, thus the total would be 5,900

        for (let i = 0;i < 9;i++) {
            let img = document.createElement("img")
            img.style.position = "absolute"
            img.className = "kids"
            img.src = "ChildWalk.gif"
            document.body.appendChild(img)
            img.id = "Child" + i
            img.style.top = 61 + "%"
            img.style.zIndex = 3
            img.style.width = 5 + "%"
            img.style.left = (i * 85) + document.documentElement.clientWidth / 2 - 9 * 85 / 2 + "px"
        }
        for (kid of document.getElementsByClassName('kids')) {
            kids.push({ element: kid, wallTouched: null, position: Number(kid.style.left.replace('px', '')), movement: { speed: 0, time: 0 }, initDirection: ['left', 'right'][Math.floor(Math.random() * 2)], scared: false })
        }
        function ChildMoving() {
            for (kid of kids) {
                if (kid.element) {
                    if (kid.movement.time <= 0) {
                        kid.movement.speed = Math.floor(Math.random() * 5)
                        kid.movement.time = Math.floor(Math.random() * 300)
                    }
                    if (!scaring) {
                        if (kid.initDirection == 'left') kid.position -= kid.movement.speed
                        else if (kid.initDirection == 'right') kid.position += kid.movement.speed
                        else if (kid.wallTouched == 'left') kid.position += kid.movement.speed
                        else if (kid.wallTouched == 'right') kid.position -= kid.movement.speed
                    }

                    if (kid.position >= RIGHT_WAll - kids[0].element.clientWidth) {

                        kid.initDirection = null
                        kid.wallTouched = 'right'
                    }
                    else if (kid.position <= LEFT_WALL) {
                        kid.initDirection = null
                        kid.wallTouched = 'left'
                    }

                    kid.element.style.left = kid.position + 'px'
                    kid.movement.time -= 1
                }
            }
        }

        function jumpScare() {
            if (mode == 'normal') didScare = true
            canScare = false
            scaring = true
            for (kid of kids) {
                if (kid.position >= LEMONADE_CLOWN.position - SCARE_DISTANCE + LEMONADE_CLOWN.element.clientWidth / 2 - kids[0].element.clientWidth / 2 &&
                    kid.position <= LEMONADE_CLOWN.position + SCARE_DISTANCE + LEMONADE_CLOWN.element.clientWidth / 2 - kids[0].element.clientWidth / 2) {
                    kid.element.src = "ChildScared.png"
                    LEMONADE_CLOWN.element.src = "jump.png"
                    kid.scared = true
                    scaredKids += 1
                }
            }
            for (let i = 0;i < kids.length;i++) {
                for (scaredKid of kids) {
                    if (scaredKid.scared) {
                        for (kid of kids) {
                            if (kid.position >= scaredKid.position - CHAIN_DISTANCE - kids[0].element.clientWidth / 2 &&
                                kid.position <= scaredKid.position + CHAIN_DISTANCE - kids[0].element.clientWidth / 2 &&
                                !kid.scared) {
                                kid.element.src = "ChildScared.png"
                                LEMONADE_CLOWN.element.src = "jump.png"
                                kid.scared = true
                                scaredKids += 1
                            }
                        }
                    }
                }
            }
            score += scaredKids * 100
            if (scaredKids >= 9) {
                score += 5000
            }
            document.getElementById('score').innerText = score
            scaredKids = 0
            setTimeout(() => {
                scaring = false
                for (kid of kids) {
                    kid.element.src = "ChildWalk.gif"
                    LEMONADE_CLOWN.element.src = "idle.png"
                    kid.scared = false
                }
                setTimeout(() => {
                    canScare = true
                }, 3000);
            }, 1500)
        }

        document.addEventListener('keydown', function (event) {
            if (event.keyCode == 32 && gameStarted && canScare) {
                if (mode == 'normal') {
                    if (!didScare) jumpScare()
                }
                else
                    jumpScare()
            }
        })

        document.addEventListener('keydown', function (event) {
            if (event.keyCode == 32 && !gameStarted && mode != 'menu') {
                gameStarted = 'starting'
                let flashes = 0
                clearInterval(slowTitleFlash)
                title.innerText = 'GO!!'
                fastTitleFlash = setInterval(titleFlash, 100)
                setTimeout(() => {
                    clearInterval(fastTitleFlash)
                    title.style.visibility = 'hidden'
                    directions.style.visibility = 'hidden'
                    controls.style.visibility = ''
                    setInterval(ChildMoving, 1)
                    gameStarted = true
                    setTimeout(() => {
                        canScare = true
                    }, 1000)
                }, 750);
            }
        })
        function checkMode() {
            if (mode == "menu") {
                scareRange.style.visibility = "hidden"
                scoreElement.style.visibility = "hidden"
                for (kid of kids) {
                    kid.element.style.visibility = "hidden"
                }
                title.style.visibility = ""
                modesElement.style.visibility = ""
                directions.style.visibility = 'hidden'
                controls.style.visibility = 'hidden'
            }
            else {
                title.innerText = 'GET FREDDY!'
                scareRange.style.visibility = ""
                scoreElement.style.visibility = ""
                for (kid of kids) {
                    kid.element.style.visibility = ""
                }
                modesElement.style.visibility = "hidden"
                directions.style.visibility = ''
                slowTitleFlash = setInterval(titleFlash, 500)
            }
        }
        function changeMode(selectedMode) {
            mode = selectedMode
            checkMode()
        }
        function titleFlash() {
            if (title.style.visibility == 'hidden')
                title.style.visibility = ''
            else if (title.style.visibility == '')
                title.style.visibility = 'hidden'
        }
        checkMode()
    </script>

</body>

</html>